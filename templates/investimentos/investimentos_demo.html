{% extends "base.html" %}
{% block title %}Investimentos - Demonstração{% endblock %}

{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3><i class="fas fa-piggy-bank me-2"></i>Investimentos por Sector (Demo)</h3>
    <a href="{% url 'dashboard' %}" class="btn btn-secondary">Voltar</a>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <canvas id="chartInvestimentos" style="height:240px;"></canvas>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Resumo por Sector</div>
    <div class="card-body">
      <table class="table table-striped">
        <thead class="table-dark">
          <tr>
            <th>Sector</th>
            <th class="text-end">Despesas (Kz)</th>
            <th class="text-end">Combustível (Kz)</th>
            <th class="text-end">Total (Kz)</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for s in sectores_data %}
            <tr>
              <td>{{ s.nome }}</td>
              <td class="text-end">{% localize on %}{{ s.total_despesas|floatformat:2 }}{% endlocalize %}</td>
              <td class="text-end">{% localize on %}{{ s.total_combustivel|floatformat:2 }}{% endlocalize %}</td>
              <td class="text-end fw-bold">{% localize on %}{{ s.total|floatformat:2 }}{% endlocalize %}</td>
              <td>
                <a href="{% url 'investimento_sector' s.slug %}" class="btn btn-sm btn-info">Ver Detalhe</a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5" class="text-center text-muted">Sem sectores</td></tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="mt-3 text-end">
        <strong>Total Geral:</strong> {% localize on %}{{ total_geral|floatformat:2 }}{% endlocalize %} Kz
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const labels = {{ labels_json|default:"[]"|safe }};
const dataValues = {{ valores_json|default:"[]"|safe }};

new Chart(document.getElementById('chartInvestimentos'), {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      label: 'Total Investido (Kz)',
      data: dataValues,
      backgroundColor: 'rgba(36,99,163,0.7)',
      borderColor: 'rgba(36,99,163,1)',
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: { ticks: { callback: v => new Intl.NumberFormat('pt-BR').format(v) + ' Kz' } }
    }
  }
});
</script>
{% endblock %}