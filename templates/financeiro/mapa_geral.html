{% extends "base.html" %}
{% load humanize %}

{% block title %}Mapa Geral Financeiro{% endblock %}

{% block content %}

<style>
  .report-wrapper {
    background: #ffffff;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    border: 1px solid #ccc;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-family: Arial, sans-serif;
    font-size: 14px;
    border-radius: 10px;
    overflow: hidden;
  }

  th, td {
    border: 1px solid #000;
    padding: 8px;
    text-align: center;
  }

  th {
    font-weight: bold;
    letter-spacing: .4px;
  }

  .header-blue {
    background: #05b3f0;
    color: white;
    font-size: 18px;
  }

  .subheader {
    background: #ffe699;
    font-weight: bold;
  }

  .week {
    background: #3f4f63;
    color: white;
  }

  .left-title {
    background: #05b3f0;
    color: black;
    font-weight: bold;
  }

  .row-green { background: #e7f2df; }
  .total-green { background: #7cb342; font-weight: bold; }

  .section-orange {
    background: #ff7a00;
    font-weight: bold;
    text-transform: uppercase;
  }

  .row-orange { background: #fde9d9; }
  .total-orange { background: #f4a460; font-weight: bold; }

  .saldo-blue { background: #05b3f0; color: white; font-weight: bold; }
  .saldo-yellow { background: #fff2a8; font-weight: bold; }
  .saldo-red { background: #ff6b6b; font-weight: bold; }
  .saldo-green { background: #6cc070; font-weight: bold; }

  .final-green { background: #6cc070; font-weight: bold; }
  .final-red { background: #ff6b6b; font-weight: bold; }
  .final-yellow { background: #ffe066; font-weight: bold; }

  td.text-start {
    text-align: left;
    padding-left: 12px;
    font-weight: 600;
  }

  .filters {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 15px;
  }

  .filters select,
  .filters input {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #aaa;
    font-weight: bold;
  }

  .filters button {
    padding: 6px 14px;
    font-weight: bold;
  }

  @media print {
    body { background: white; }
    .filters, .actions { display: none; }
    .report-wrapper {
      box-shadow: none;
      border: none;
      padding: 0;
    }
    table { font-size: 12px; }
  }
</style>

<h2 style="text-align:center;">MAPA GERAL FINANCEIRO</h2>

<form method="get" class="filters">
  <select name="sector">
    <option value="all">Todos os sectores</option>
    {% for s in sectores %}
      <option value="{{ s.id }}" {% if sector and sector.id == s.id %}selected{% endif %}>
        {{ s.nome }}
      </option>
    {% endfor %}
  </select>

  <input type="number" name="mes" min="1" max="12" value="{{ mes }}" placeholder="M√™s">
  <input type="number" name="ano" min="2000" max="2100" value="{{ ano }}" placeholder="Ano">

  <button type="submit">Filtrar</button>
</form>

<div class="actions" style="margin-bottom:15px;">
  <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
</div>

<div class="report-wrapper">
<table>

  <tr>
    <th class="header-blue" colspan="6">
      {% if sector %}
        {{ sector.nome|upper }}
      {% else %}
        TODOS OS SECTORES ‚Äì LUANDA
      {% endif %}
    </th>
  </tr>

  <tr>
    <th class="left-title" rowspan="2">CONTROLO FINANCEIRO<br>MAPA GERAL</th>
    <th class="subheader" colspan="4">{{ mes }}/{{ ano }}</th>
    <th class="left-title" rowspan="2">TOTAL MENSAL</th>
  </tr>

  <tr>
    <th class="week">1¬™ SEMANA</th>
    <th class="week">2¬™ SEMANA</th>
    <th class="week">3¬™ SEMANA</th>
    <th class="week">4¬™ SEMANA</th>
  </tr>

  <tr class="row-green">
    <td class="text-start">DI√ÅRIA</td>
    <td>{{ semanas.1.entradas.normal|intcomma }}</td>
    <td>{{ semanas.2.entradas.normal|intcomma }}</td>
    <td>{{ semanas.3.entradas.normal|intcomma }}</td>
    <td>{{ semanas.4.entradas.normal|intcomma }}</td>
    <td>{{ total_entradas|intcomma }}</td>
  </tr>

  <tr class="row-green">
    <td class="text-start">FRETE</td>
    <td>{{ semanas.1.entradas.frete|intcomma }}</td>
    <td>{{ semanas.2.entradas.frete|intcomma }}</td>
    <td>{{ semanas.3.entradas.frete|intcomma }}</td>
    <td>{{ semanas.4.entradas.frete|intcomma }}</td>
    <td>{{ total_entradas|intcomma }}</td>
  </tr>

  <tr class="total-green">
    <td class="text-start">TOTAL ENTRADAS</td>
    <td>{{ semanas.1.entradas.total|intcomma }}</td>
    <td>{{ semanas.2.entradas.total|intcomma }}</td>
    <td>{{ semanas.3.entradas.total|intcomma }}</td>
    <td>{{ semanas.4.entradas.total|intcomma }}</td>
    <td>{{ total_entradas|intcomma }}</td>
  </tr>

  <tr class="section-orange">
    <td colspan="6">DESPESAS FIXAS</td>
  </tr>

  <tr class="row-orange">
    <td class="text-start">COMBUST√çVEL</td>
    <td>{{ semanas.1.despesas.combustivel|intcomma }}</td>
    <td>{{ semanas.2.despesas.combustivel|intcomma }}</td>
    <td>{{ semanas.3.despesas.combustivel|intcomma }}</td>
    <td>{{ semanas.4.despesas.combustivel|intcomma }}</td>
    <td>{{ total_despesas|intcomma }}</td>
  </tr>

  <tr class="row-orange">
    <td class="text-start">LAVAGEM</td>
    <td>{{ semanas.1.despesas.lavagem|intcomma }}</td>
    <td>{{ semanas.2.despesas.lavagem|intcomma }}</td>
    <td>{{ semanas.3.despesas.lavagem|intcomma }}</td>
    <td>{{ semanas.4.despesas.lavagem|intcomma }}</td>
    <td>{{ total_despesas|intcomma }}</td>
  </tr>

  <tr class="total-orange">
    <td class="text-start">TOTAL DESPESAS</td>
    <td>{{ semanas.1.despesas.total|intcomma }}</td>
    <td>{{ semanas.2.despesas.total|intcomma }}</td>
    <td>{{ semanas.3.despesas.total|intcomma }}</td>
    <td>{{ semanas.4.despesas.total|intcomma }}</td>
    <td>{{ total_despesas|intcomma }}</td>
  </tr>

  <tr>
    <td class="saldo-blue text-start">SALDO SEMANAL</td>
    <td class="saldo-yellow">{{ semanas.1.saldo|intcomma }}</td>
    <td class="saldo-yellow">{{ semanas.2.saldo|intcomma }}</td>
    <td class="saldo-red">{{ semanas.3.saldo|intcomma }}</td>
    <td class="saldo-yellow">{{ semanas.4.saldo|intcomma }}</td>
    <td class="saldo-green">{{ saldo_liquido|intcomma }}</td>
  </tr>

  <tr class="final-green">
    <td class="text-start">ENTRADAS GERAIS</td>
    <td colspan="5">{{ total_entradas|intcomma }}</td>
  </tr>

  <tr class="final-red">
    <td class="text-start">DESPESAS GERAIS</td>
    <td colspan="5">{{ total_despesas|intcomma }}</td>
  </tr>

  <tr class="final-yellow">
    <td class="text-start">SALDO L√çQUIDO</td>
    <td colspan="5">{{ saldo_liquido|intcomma }}</td>
  </tr>

</table>
</div>

{% endblock %}
