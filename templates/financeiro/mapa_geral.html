{% extends "base.html" %}
{% load humanize %}

{% block title %}Mapa Geral Financeiro{% endblock %}

{% block content %}

<style>
  table {
    width: 100%;
    border-collapse: collapse;
    font-family: Arial, sans-serif;
    font-size: 14px;
  }
  th, td {
    border: 2px solid #000;
    padding: 6px;
    text-align: center;
  }

  .header-blue {
    background: #05b3f0;
    color: white;
    font-weight: bold;
    font-size: 18px;
  }

  .subheader {
    background: #ffe699;
    font-weight: bold;
  }

  .week {
    background: #3f4f63;
    color: white;
    font-weight: bold;
  }

  .left-title {
    background: #05b3f0;
    color: black;
    font-weight: bold;
  }

  .row-green { background: #e7f2df; }
  .total-green { background: #7cb342; color: black; font-weight: bold; }

  .section-orange { background: #ff7a00; color: black; font-weight: bold; }

  .row-orange { background: #fde9d9; }
  .total-orange { background: #f4a460; font-weight: bold; }

  .saldo-blue { background: #05b3f0; color: white; font-weight: bold; }
  .saldo-yellow { background: #fff2a8; font-weight: bold; }
  .saldo-red { background: #ff6b6b; font-weight: bold; }
  .saldo-green { background: #6cc070; font-weight: bold; }

  .final-green { background: #6cc070; font-weight: bold; }
  .final-red { background: #ff6b6b; font-weight: bold; }
  .final-yellow { background: #ffe066; font-weight: bold; }

  td.text-start { text-align: left; padding-left: 10px; }

  @media print {
  body {
    background: white;
  }

  button, a {
    display: none;
  }

  table {
    font-size: 12px;
  }

  h2 {
    margin-bottom: 10px;
  }
}

</style>

<h2 style="text-align:center;">MAPA GERAL FINANCEIRO</h2>

<div style="margin-bottom:15px; display:flex; gap:10px;">
  <button onclick="window.print()" style="padding:8px 14px;">üñ®Ô∏è Imprimir</button>

  <a href="{% url 'mapa_geral_pdf' %}?sector={{ sector.id }}&mes={{ mes }}&ano={{ ano }}"
     style="padding:8px 14px; background:#dc3545; color:white; text-decoration:none;">
     üìÑ Exportar PDF
  </a>

  <a href="{% url 'mapa_geral_excel' %}?sector={{ sector.id }}&mes={{ mes }}&ano={{ ano }}"
     style="padding:8px 14px; background:#28a745; color:white; text-decoration:none;">
     üìä Exportar Excel
  </a>
</div>

<table>

  <!-- CABE√áALHO -->
  <tr>
    <th class="header-blue" colspan="6">LUANDA</th>
  </tr>
  <tr>
    <th class="left-title" rowspan="2">CONTROLO FINANCEIRO<br>MAPA GERAL</th>
    <th class="subheader" colspan="4">{{ mes }}/{{ ano }}</th>
    <th class="left-title" rowspan="2">TOTAL MENSAL</th>
  </tr>
  <tr>
    <th class="week">1¬™ SEMANA</th>
    <th class="week">2¬™ SEMANA</th>
    <th class="week">3¬™ SEMANA</th>
    <th class="week">4¬™ SEMANA</th>
  </tr>

  <!-- ENTRADAS -->
  <tr class="row-green">
    <td class="text-start">DI√ÅRIA</td>
    <td>{{ semanas.1.entradas.normal|intcomma }}</td>
    <td>{{ semanas.2.entradas.normal|intcomma }}</td>
    <td>{{ semanas.3.entradas.normal|intcomma }}</td>
    <td>{{ semanas.4.entradas.normal|intcomma }}</td>
    <td>{{ total_entradas|intcomma }}</td>
  </tr>

  <tr class="row-green">
    <td class="text-start">FRETE</td>
    <td>{{ semanas.1.entradas.frete|intcomma }}</td>
    <td>{{ semanas.2.entradas.frete|intcomma }}</td>
    <td>{{ semanas.3.entradas.frete|intcomma }}</td>
    <td>{{ semanas.4.entradas.frete|intcomma }}</td>
    <td>{{ total_entradas|intcomma }}</td>
  </tr>

  <tr class="total-green">
    <td class="text-start">TOTAL</td>
    <td>{{ semanas.1.entradas.total|intcomma }}</td>
    <td>{{ semanas.2.entradas.total|intcomma }}</td>
    <td>{{ semanas.3.entradas.total|intcomma }}</td>
    <td>{{ semanas.4.entradas.total|intcomma }}</td>
    <td>{{ total_entradas|intcomma }}</td>
  </tr>

  <!-- DESPESAS FIXAS -->
  <tr class="section-orange">
    <td colspan="6">DESPESAS FIXAS</td>
  </tr>

  <tr class="row-orange">
    <td class="text-start">COMBUST√çVEL AUTOCARROS</td>
    <td>{{ semanas.1.despesas.combustivel|intcomma }}</td>
    <td>{{ semanas.2.despesas.combustivel|intcomma }}</td>
    <td>{{ semanas.3.despesas.combustivel|intcomma }}</td>
    <td>{{ semanas.4.despesas.combustivel|intcomma }}</td>
    <td>{{ total_despesas|intcomma }}</td>
  </tr>

  <tr class="row-orange">
    <td class="text-start">LAVAGEM</td>
    <td>{{ semanas.1.despesas.lavagem|intcomma }}</td>
    <td>{{ semanas.2.despesas.lavagem|intcomma }}</td>
    <td>{{ semanas.3.despesas.lavagem|intcomma }}</td>
    <td>{{ semanas.4.despesas.lavagem|intcomma }}</td>
    <td>{{ total_despesas|intcomma }}</td>
  </tr>

  <tr class="total-orange">
    <td class="text-start">TOTAL</td>
    <td>{{ semanas.1.despesas.total|intcomma }}</td>
    <td>{{ semanas.2.despesas.total|intcomma }}</td>
    <td>{{ semanas.3.despesas.total|intcomma }}</td>
    <td>{{ semanas.4.despesas.total|intcomma }}</td>
    <td>{{ total_despesas|intcomma }}</td>
  </tr>

  <!-- SALDO SEMANAL -->
  <tr>
    <td class="saldo-blue text-start">SALDO SEMANAL</td>
    <td class="saldo-yellow">{{ semanas.1.saldo|intcomma }}</td>
    <td class="saldo-yellow">{{ semanas.2.saldo|intcomma }}</td>
    <td class="saldo-red">{{ semanas.3.saldo|intcomma }}</td>
    <td class="saldo-yellow">{{ semanas.4.saldo|intcomma }}</td>
    <td class="saldo-green">{{ saldo_liquido|intcomma }}</td>
  </tr>

  <!-- RESUMO FINAL -->
  <tr class="final-green">
    <td class="text-start">ENTRADAS GERAIS</td>
    <td colspan="5">{{ total_entradas|intcomma }}</td>
  </tr>

  <tr class="final-red">
    <td class="text-start">DESPESAS FIXAS E VARI√ÅVEIS</td>
    <td colspan="5">{{ total_despesas|intcomma }}</td>
  </tr>

  <tr class="final-yellow">
    <td class="text-start">SALDO L√çQUIDO</td>
    <td colspan="5">{{ saldo_liquido|intcomma }}</td>
  </tr>

</table>

{% endblock %}
