{% extends 'base.html' %}
{% load humanize %}
{% load l10n %}

{% block title %}Resumo Financeiro{% endblock %}

{% block content %}
<style>
.container { max-width:1100px; margin:18px auto; }
.selector-row { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
.month-input { padding:6px 10px; border-radius:6px; border:1px solid #e6edf3; background:#fff; }

.linha { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:12px; margin-bottom:18px; }
.bloco { padding:14px; border-radius:10px; color:#fff; box-shadow: 0 2px 6px rgba(2,6,23,0.06); min-height:92px; display:flex; flex-direction:column; justify-content:space-between; }
.bloco .titulo { font-weight:700; display:flex; align-items:center; gap:8px; font-size:0.95rem; }
.bloco .valor { font-size:1.25rem; font-weight:800; margin-top:6px; }
.muted { font-size:0.9rem; opacity:0.9; color:rgba(255,255,255,0.9); }

/* cores requeridas */
.bg-entradas { background: linear-gradient(135deg,#059669,#10b981); }   /* verde */
.bg-saidas { background: linear-gradient(135deg,#b91c1c,#ef4444); }     /* vermelho */
.bg-saldo { background: linear-gradient(135deg,#b45309,#f59e0b); }      /* amarelo/âmbar */
.bg-lucro { background: linear-gradient(135deg,#c2410c,#f97316); }      /* laranja */
.bg-combustivel { background: linear-gradient(135deg,#92400e,#f97316); } /* laranja-escuro */
.bg-fixas { background: linear-gradient(135deg,#0369a1,#0ea5e9); }      /* azul */
.bg-variaveis { background: linear-gradient(135deg,#6b21a8,#8b5cf6); }   /* roxo */

.icon { width:18px; height:18px; display:inline-block; vertical-align:middle; }

/* responsividade e pequenos ajustes */
.small-muted { font-size:0.8rem; opacity:0.95; color:rgba(255,255,255,0.95); }
</style>

<div class="container">

    <!-- Seletor de mês -->
    <form method="get" class="selector-row" style="justify-content:flex-end;">
        <label for="mes" class="muted" style="color:#334155; font-weight:600; margin-right:8px;">Selecionar mês:</label>
        <input id="mes" name="mes" type="month" class="month-input" value="{{ request.GET.mes|default:'' }}">
        <button type="submit" class="month-input" style="background:#0f172a;color:#fff;border:0;padding:7px 10px;border-radius:6px;">Aplicar</button>
    </form>

    <!-- ENTRADAS (verde) -->
    <div class="linha">
        <div class="bloco bg-entradas">
            <div class="titulo"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1v22"/></svg> Normal</div>
            <div class="valor">{% localize on %}{{ serie_normal|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Série mensal (último)</div>
        </div>

        <div class="bloco bg-entradas">
            <div class="titulo"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12h18"/></svg> Alunos</div>
            <div class="valor">{% localize on %}{{ serie_alunos|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Série mensal (último)</div>
        </div>

        <div class="bloco bg-entradas">
            <div class="titulo"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6h16v12H4z"/></svg> Luvu</div>
            <div class="valor">{% localize on %}{{ serie_luvu|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Série mensal (último)</div>
        </div>

        <div class="bloco bg-entradas">
            <div class="titulo"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h18v18H3z"/></svg> Frete / Outros</div>
            <div class="valor">{% localize on %}{{ serie_frete|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Série mensal (último)</div>
        </div>
    </div>

    <!-- Entradas totais -->
    <div class="linha section-row">
        <div class="bloco bg-entradas" style="grid-column: span 2;">
            <div class="titulo"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.6"><path d="M12 1v22"/></svg> Entradas Totais</div>
            <div class="valor">{% localize on %}{{ serie_entradas|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Soma de todas as entradas (último mês)</div>
        </div>
    </div>

    <!-- SAÍDAS (vermelho) -->
    <div class="linha">
        <div class="bloco bg-saidas">
            <div class="titulo">Alimentação</div>
            <div class="valor">{% localize on %}{{ serie_alimentacao|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Registro</div>
        </div>

        <div class="bloco bg-saidas">
            <div class="titulo">Parqueamento</div>
            <div class="valor">{% localize on %}{{ serie_parqueamento|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Registro</div>
        </div>

        <div class="bloco bg-saidas">
            <div class="titulo">Taxas</div>
            <div class="valor">{% localize on %}{{ serie_taxa|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Registro</div>
        </div>

        <div class="bloco bg-saidas">
            <div class="titulo">Outros</div>
            <div class="valor">{% localize on %}{{ serie_outros|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Registro</div>
        </div>
    </div>

    <div class="linha section-row">
        <div class="bloco bg-saidas" style="grid-column: span 2;">
            <div class="titulo">Despesas Extra (Relatórios)</div>
            <div class="valor">{% localize on %}{{ serie_despesas_extra|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Despesa geral por sector</div>
        </div>

        <div class="bloco bg-saidas" style="grid-column: span 2;">
            <div class="titulo">Saídas Totais (inclui combustível e extras)</div>
            <div class="valor">{% localize on %}{{ serie_saidas|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Soma das saídas (último mês)</div>
        </div>
    </div>

    <!-- COMBUSTÍVEL (separado) -->
    <div class="linha">
        <div class="bloco bg-combustivel">
            <div class="titulo">Combustível (valor)</div>
            <div class="valor">{% localize on %}{{ serie_combustivel_valor|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Total combustível</div>
        </div>

        <div class="bloco bg-combustivel">
            <div class="titulo">Sobragem / Filtros</div>
            <div class="valor">{% localize on %}{{ serie_combustivel_sobragem|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Sobragem/filtros</div>
        </div>

        <div class="bloco bg-combustivel">
            <div class="titulo">Lavagem</div>
            <div class="valor">{% localize on %}{{ serie_combustivel_lavagem|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Lavagem</div>
        </div>
    </div>

    <!-- SALDO (amarelo) e LUCRO (laranja) -->
    <div class="linha section-row">
        <div class="bloco bg-saldo" style="grid-column: span 2;">
            <div class="titulo">Saldo (Entradas - Saídas)</div>
            <div class="valor">{% localize on %}{{ serie_saldo|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Saldo do mês (último)</div>
        </div>

        <div class="bloco bg-lucro" style="grid-column: span 2;">
            <div class="titulo">Lucro Final</div>
            <div class="valor">{% localize on %}{{ serie_lucro|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Saldo menos despesas fixas e variáveis</div>
        </div>
    </div>

    <!-- DESPESAS FIXAS (usa variável do contexto diretamente) -->
    <div class="linha section-row">
        <div class="bloco bg-fixas" style="grid-column: span 2;">
            <div class="titulo">Despesas Fixas (Total)</div>
            <div class="valor">{% localize on %}{{ serie_total_despesas_fixas|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Soma das despesas fixas (último mês)</div>
        </div>

        <div class="bloco bg-variaveis" style="grid-column: span 2;">
            <div class="titulo">Despesas Variáveis (Total)</div>
            <div class="valor">{% localize on %}{{ serie_despesas_variaveis|last|default:0|floatformat:2 }}{% endlocalize %} Kz</div>
            <div class="small-muted">Despesas variáveis (último mês)</div>
        </div>
    </div>

</div>
{% endblock %}
