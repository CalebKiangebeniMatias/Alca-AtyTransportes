{% extends 'base.html' %}

{% block title %}
    {% if relatorio %}
        Editar Relat贸rio do Setor - {{ relatorio.sector.nome }}
    {% else %}
        Novo Relat贸rio do Setor
    {% endif %}
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow-lg">
            <div class="card-header {% if relatorio %}bg-warning text-dark{% else %}bg-primary text-white{% endif %}">
                <h4 class="mb-0">
                    {% if relatorio %}
                        <i class="fas fa-edit me-2"></i> Editar Relat贸rio do Setor
                    {% else %}
                        <i class="fas fa-plus-circle me-2"></i> Novo Relat贸rio do Setor
                    {% endif %}
                </h4>
            </div>

            <div class="card-body">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}

                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ relatorio_form.sector.label }}</label>
                                {{ relatorio_form.sector }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ relatorio_form.data.label }}</label>
                                {{ relatorio_form.data }}
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold text-danger">
                            <i class="fas fa-coins me-1"></i> {{ relatorio_form.despesa_geral.label }}
                        </label>
                        <div class="input-group">
                            <span class="input-group-text">Kz</span>
                            {{ relatorio_form.despesa_geral }}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">{{ relatorio_form.descricao.label }}</label>
                        {{ relatorio_form.descricao }}
                    </div>

                    <!--  Comprovativos -->
                    <div class="border rounded p-3 mb-4 bg-light">
                        <h5 class="text-primary mb-3">
                            <i class="fas fa-images me-2"></i> Comprovativos
                        </h5>

                        <div class="mb-3">
                            {{ multi_file_form.arquivos }}
                        </div>

                        {% if relatorio and relatorio.comprovativos.exists %}
                            <div class="mt-3">
                                <h6 class="text-success mb-2">
                                    <i class="fas fa-paperclip me-1"></i> Comprovativos Existentes
                                </h6>
                                {% for comp in relatorio.comprovativos.all %}
                                    <div class="d-flex justify-content-between align-items-center border-bottom py-1">
                                        <a href="{{ comp.arquivo.url }}" target="_blank" class="text-decoration-none text-primary">
                                            {{ comp.arquivo.name|slice:"-30:" }}
                                        </a>
                                        <a href="{% url 'remover_comprovativo' comp.id %}" class="text-danger small" onclick="return confirm('Remover este comprovativo?');">
                                            <i class="fas fa-trash-alt"></i>
                                        </a>
                                    </div>
                                {% empty %}
                                    <small class="text-muted">Nenhum comprovativo anexado.</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!--  Bot玫es -->
                    <div class="text-center mt-4">
                        <button type="submit" class="btn {% if relatorio %}btn-warning{% else %}btn-success{% endif %} btn-lg me-2">
                            <i class="fas fa-save me-2"></i>
                            {% if relatorio %}Salvar Altera莽玫es{% else %}Criar Relat贸rio{% endif %}
                        </button>
                        <a href="{% url 'listar_registros' %}" class="btn btn-secondary btn-lg">
                            <i class="fas fa-times me-2"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
